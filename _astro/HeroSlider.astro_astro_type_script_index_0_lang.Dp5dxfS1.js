document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".brand-link").forEach(a=>{a.addEventListener("click",t=>{t.preventDefault();const i=a.dataset.mode;G(i)})}),window.addEventListener("popstate",()=>{const a=window.location.pathname==="/labs"||window.location.pathname==="/labs/";T(a?"labs":"films")})});function G(d){const a=d==="labs";history.pushState({mode:d},"",a?"/labs":"/"),document.body.classList.toggle("mode-labs",a),document.body.classList.toggle("mode-films",!a),T(d)}function T(d){const a=document.querySelector(".brand-films"),t=document.querySelector(".brand-labs");a?.classList.toggle("active",d==="films"),t?.classList.toggle("active",d==="labs")}(function(){const a=document.getElementById("circuit-canvas");if(!a)return;const t=a.getContext("2d"),i=70,x=1.5,o=[0,206,209];let M=[],C=0,R=0;function P(){const r=window.devicePixelRatio||1,n=a.parentElement.getBoundingClientRect();a.width=n.width*r,a.height=n.height*r,t.setTransform(r,0,0,r,0,0),C=Math.ceil(n.width/i),R=Math.ceil(n.height/i)}function q(){const r=Math.floor(Math.random()*C)*i,n=Math.floor(Math.random()*R)*i,c=[[1,0],[-1,0],[0,1],[0,-1]],u=[];let p=r,h=n;const $=2+Math.floor(Math.random()*4);for(let g=0;g<$;g++){const e=c[Math.floor(Math.random()*c.length)],l=2+Math.floor(Math.random()*5),f=p+e[0]*l*i,b=h+e[1]*l*i;u.push([p,h,f,b]),p=f,h=b}const w=u.reduce((g,e)=>g+Math.abs(e[2]-e[0])+Math.abs(e[3]-e[1]),0);M.push({x:r,y:n,tx:p,ty:h,progress:0,speed:.8+Math.random()*1.5,alpha:.25+Math.random()*.35,segments:u,totalLen:w})}function L(r){if(!document.body.classList.contains("mode-labs")){requestAnimationFrame(L);return}const n=a.width/(window.devicePixelRatio||1),c=a.height/(window.devicePixelRatio||1);t.fillStyle="#080a0f",t.fillRect(0,0,n,c),t.strokeStyle=`rgba(${o[0]}, ${o[1]}, ${o[2]}, 0.06)`,t.lineWidth=.5;for(let e=0;e<=n;e+=i)t.beginPath(),t.moveTo(e,0),t.lineTo(e,c),t.stroke();for(let e=0;e<=c;e+=i)t.beginPath(),t.moveTo(0,e),t.lineTo(n,e),t.stroke();for(let e=0;e<=n;e+=i)for(let l=0;l<=c;l+=i){const f=Math.sin(r*8e-4+e*.05+l*.07)*.5+.5,b=.08+f*.18;if(t.beginPath(),t.arc(e,l,x,0,Math.PI*2),t.fillStyle=`rgba(${o[0]}, ${o[1]}, ${o[2]}, ${b})`,t.fill(),f>.75){const s=x*6,m=t.createRadialGradient(e,l,0,e,l,s);m.addColorStop(0,`rgba(${o[0]}, ${o[1]}, ${o[2]}, ${f*.12})`),m.addColorStop(1,"transparent"),t.beginPath(),t.arc(e,l,s,0,Math.PI*2),t.fillStyle=m,t.fill()}}M.forEach((e,l)=>{e.progress+=e.speed;const f=e.segments;let b=0;t.strokeStyle=`rgba(${o[0]}, ${o[1]}, ${o[2]}, ${e.alpha})`,t.lineWidth=1.5,t.shadowColor=`rgba(${o[0]}, ${o[1]}, ${o[2]}, ${e.alpha*.6})`,t.shadowBlur=8;for(const s of f){const m=Math.abs(s[2]-s[0])+Math.abs(s[3]-s[1]),E=b,A=b+m;if(e.progress>E){const k=Math.min(1,(e.progress-E)/m),y=s[0]+(s[2]-s[0])*k,S=s[1]+(s[3]-s[1])*k;if(t.beginPath(),t.moveTo(s[0],s[1]),t.lineTo(y,S),t.stroke(),e.progress<A){const v=t.createRadialGradient(y,S,0,y,S,6);v.addColorStop(0,`rgba(${o[0]}, ${o[1]}, ${o[2]}, 0.8)`),v.addColorStop(1,"transparent"),t.beginPath(),t.arc(y,S,6,0,Math.PI*2),t.fillStyle=v,t.fill()}}b+=m}t.shadowBlur=0,e.progress>e.totalLen+30&&M.splice(l,1)}),Math.random()<.025&&M.length<6&&q();const u=n*(.2+.1*Math.sin(r*3e-4)),p=c*(.3+.1*Math.cos(r*4e-4)),h=t.createRadialGradient(u,p,0,u,p,300);h.addColorStop(0,`rgba(${o[0]}, ${o[1]}, ${o[2]}, 0.03)`),h.addColorStop(1,"transparent"),t.fillStyle=h,t.fillRect(0,0,n,c);const $=n*(.75+.08*Math.sin(r*5e-4)),w=c*(.65+.1*Math.cos(r*35e-5)),g=t.createRadialGradient($,w,0,$,w,250);g.addColorStop(0,`rgba(${o[0]}, ${o[1]}, ${o[2]}, 0.025)`),g.addColorStop(1,"transparent"),t.fillStyle=g,t.fillRect(0,0,n,c),requestAnimationFrame(L)}P(),window.addEventListener("resize",P),requestAnimationFrame(L)})();
