---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import HeroSlider from '../components/HeroSlider.astro';
import FilmCard from '../components/FilmCard.astro';
import { films } from '../data/films';
---

<Layout title="Sneaky Ghost Films">
  <Header isHomePage={true} />

  <HeroSlider />

  <div class="page-body">
    <!-- Productions Section -->
    <section id="productions">
      <div class="section-inner">
        <div class="wrapper">
          <div class="main-title align-center">
            <h2><strong>Productions</strong></h2>
          </div>
        </div>
        <div class="spacer spacer-medium"></div>
        <div class="portfolio-entries" id="portfolio-grid">
          {films.map((film) => (
            <FilmCard
              title={film.title}
              genre={film.genre}
              slug={film.slug}
              image={film.image}
              categories={film.categories}
            />
          ))}
        </div>
      </div>
    </section>

    <!-- About Section -->
    <section id="about">
      <div class="section-inner">
        <div class="wrapper">
          <div class="main-title align-center">
            <h2><strong>About Scott</strong></h2>
          </div>
        </div>
        <div class="spacer spacer-big"></div>
        <div id="founder-section">
          <div id="founder-window">
            <div class="imgoverlay overlay-dark overlay-transparent" id="founder-img">
              <img src="/files/uploads/scott-danzig.png" alt="Scott Danzig" loading="lazy" />
              <div class="overlaycaption" style="padding-left: 130px; padding-top: 60px">
                <h4 class="overlay-name title-minimal"><strong>Scott Danzig</strong></h4>
                <div class="separator-small"><span></span></div>
                <ul class="socialmedia-widget alttitle">
                  <li class="imdb"><a href="http://www.imdb.com/name/nm4341698/" aria-label="IMDb"></a></li>
                  <li class="quora"><a href="https://www.quora.com/profile/Scott-Danzig" aria-label="Quora"></a></li>
                  <li class="facebook"><a href="https://www.facebook.com/sneakyghost/" aria-label="Facebook"></a></li>
                  <li class="twitter"><a href="https://twitter.com/sdanzig" aria-label="Twitter"></a></li>
                </ul>
              </div>
            </div>
            <div id="founder-text-container">
              <div id="founder-text">
                <h5 class="title-minimal" style="color: #FFFFFF">Director</h5>
                <div class="spacer spacer-mini"></div>
                <p>Scott Danzig, also a software engineer and photography enthusiast, first embraced his passion for filmmaking in 2010. He has since leveraged his technical savvy to master the craft through self-study and on-set experience, learning both process and theory. Scott continues to produce his own creative works, competing in film festivals, always experimenting and reaching for the next level. He serves as a community leader, engaging local filmmakers, assisting crews how he can, and mentoring. Scott prides himself for his professionalism, striving for quality and delivering on his promises.</p>
              </div>
            </div>
          </div>
        </div>
        <div class="spacer spacer-big"></div>
        <div class="film-media demo-reel-container">
          <div class="film">
            <h4 class="title-minimal">Demo Reel</h4>
            <div class="spacer spacer-small"></div>
            <div class="fitvidsignore">
              <iframe
                width="800"
                height="450"
                src="https://www.youtube.com/embed/Eals4fFpaBU?rel=0"
                title="Sneaky Ghost Films Demo Reel"
                frameborder="0"
                allowfullscreen
                loading="lazy"
              ></iframe>
            </div>
          </div>
        </div>
        <div class="spacer spacer-small"></div>
      </div>
    </section>

    <!-- Contact Section -->
    <section id="contact" class="notoppadding">
      <div class="section-inner">
        <div class="split-section clearfix" id="contact-split">
          <div class="split-left split-half">
            <div class="split-wrapped-content">
              <div class="main-title align-center">
                <h3 data-bigletter="C"><strong>Contact</strong></h3>
                <div class="separator"><span></span></div>
                <h6 class="alttitle title-minimal">Get in touch with<br />Sneaky Ghost Films</h6>
              </div>
              <form
                id="contact-form"
                action="https://formspree.io/f/maylavkd"
                method="POST"
              >
                <fieldset>
                  <div class="form-row clearfix">
                    <label for="full-name">Name *</label>
                    <input type="text" id="full-name" name="name" placeholder="Your name" required />
                  </div>
                  <div class="form-row clearfix">
                    <label for="email-address">Email *</label>
                    <input type="email" id="email-address" name="_replyto" placeholder="Your@email.address" required />
                  </div>
                  <div class="form-row clearfix textbox">
                    <label for="message">Message *</label>
                    <textarea id="message" name="message" placeholder="What's up?" rows="5" required></textarea>
                  </div>
                  <div id="form-note" aria-live="polite">
                    <div class="alert alert-error" style="display: none;">
                      <strong>Error</strong>: Please check your entries!
                    </div>
                    <div class="alert alert-success" style="display: none;">
                      <strong>Success</strong>: Message sent!
                    </div>
                  </div>
                  <input type="text" name="_gotcha" class="is-hidden" aria-hidden="true" tabindex="-1" />
                  <input type="hidden" name="_subject" value="Contact Sneaky Ghost Films" />
                </fieldset>
                <div class="form-row form-submit">
                  <button type="submit" class="submit">Send</button>
                </div>
              </form>
            </div>
          </div>
          <div class="split-right split-half">
            <div class="split-bg">
              <div class="map-loader" style="display:flex;align-items:center;justify-content:center;padding:16px;background:#111;">
                <button class="map-load-btn" type="button" style="font-family:inherit;font-size:14px;padding:10px 14px;border:1px solid #fff;background:transparent;color:#fff;cursor:pointer;">
                  Load map
                </button>
              </div>
              <div id="map" style="height: 100%; min-height: 300px;"></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <Footer />
  </div>

  <Fragment slot="head">
    <style>
      /* Custom responsive fixes */
      @media only screen and (max-width: 640px) {
        .fb-like.right-float {
          display: none !important;
        }
        .fitvidsignore iframe {
          max-width: 100% !important;
          height: auto !important;
          min-height: 200px !important;
        }
        /* Founder/About section mobile fixes */
        #founder-section {
          height: auto !important;
        }
        #founder-window {
          min-width: unset !important;
          left: 0 !important;
          display: flex !important;
          flex-direction: column !important;
        }
        #founder-img {
          float: none !important;
          width: 100% !important;
          max-width: 100% !important;
          height: auto !important;
        }
        #founder-img img {
          width: 100% !important;
          height: auto !important;
        }
        #founder-text-container {
          width: 100% !important;
          padding: 30px 20px !important;
          box-sizing: border-box !important;
        }
        #founder-text p {
          margin: 0 !important;
          line-height: 1.6 !important;
        }
        #founder-text {
          max-width: 100% !important;
          padding: 0 !important;
          position: static !important;
          transform: none !important;
          left: auto !important;
          top: auto !important;
        }
        #founder-img .overlaycaption {
          padding: 15px !important;
          text-align: center !important;
        }
        #about .film-media {
          margin-bottom: 60px !important;
        }
        .demo-reel-container {
          padding: 0 15px !important;
        }
        .demo-reel-container h4 {
          text-align: center !important;
        }
        .demo-reel-container .film {
          min-width: unset !important;
          height: auto !important;
          width: 100% !important;
        }
      }

      /* Responsive layout for most screens */
      @media only screen and (max-width: 1200px) {
        #founder-section {
          height: auto !important;
        }
        #founder-window {
          min-width: unset !important;
          left: 0 !important;
          display: flex !important;
          flex-direction: column !important;
        }
        #founder-img {
          float: none !important;
          width: 100% !important;
          height: auto !important;
        }
        #founder-img img {
          width: 100% !important;
          height: auto !important;
        }
        #founder-text-container {
          width: 100% !important;
          padding: 40px 30px !important;
          box-sizing: border-box !important;
        }
        #founder-text {
          max-width: 600px !important;
          margin: 0 auto !important;
          padding: 0 !important;
          position: static !important;
          transform: none !important;
          left: auto !important;
          top: auto !important;
        }
        #founder-img .overlaycaption {
          padding: 20px !important;
          text-align: center !important;
        }
        .demo-reel-container .film {
          min-width: unset !important;
          height: auto !important;
          width: 100% !important;
        }
      }

      /* Demo reel styles - global overrides */
      .demo-reel-container {
        margin-bottom: 20px !important;
        max-width: 800px !important;
        margin-left: auto !important;
        margin-right: auto !important;
        padding: 0 20px !important;
        box-sizing: border-box !important;
      }
      .demo-reel-container .film {
        min-width: unset !important;
        height: auto !important;
        width: 100% !important;
        left: auto !important;
        right: auto !important;
        margin: 0 auto !important;
      }
      .fitvidsignore {
        position: relative !important;
        width: 100% !important;
        max-width: 800px !important;
        margin: 0 auto !important;
        padding-bottom: 56.25% !important; /* 16:9 aspect ratio */
        height: 0 !important;
        overflow: hidden !important;
      }
      .fitvidsignore iframe {
        position: absolute !important;
        top: 0 !important;
        left: 0 !important;
        width: 100% !important;
        height: 100% !important;
        max-width: none !important;
      }

      /* Contact form centering */
      #contact-split .split-left {
        float: none !important;
        margin: 0 auto !important;
      }
      #contact-split .split-wrapped-content {
        float: none !important;
        margin: 0 auto !important;
        max-width: 500px !important;
      }
      #contact-split .split-right {
        display: none;
      }

      /* CSS Grid for portfolio - replaces isotope masonry */
      #portfolio-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 40px;
        padding: 0 40px;
      }

      #portfolio-grid .portfolio-entry {
        width: 100%;
      }

      #portfolio-grid .entry-thumb {
        position: relative;
        overflow: hidden;
      }

      #portfolio-grid .imgoverlay {
        display: block;
        position: relative;
      }

      #portfolio-grid .imgoverlay img {
        width: 100%;
        height: auto;
        display: block;
      }

      @media (max-width: 1024px) {
        #portfolio-grid {
          grid-template-columns: repeat(2, 1fr);
          gap: 30px;
          padding: 0 30px;
        }
      }

      @media (max-width: 640px) {
        #portfolio-grid {
          grid-template-columns: 1fr;
          gap: 20px;
          padding: 0 20px;
        }
      }
    </style>
  </Fragment>

  <Fragment slot="scripts">
    <script is:inline>
      document.addEventListener('DOMContentLoaded', () => {
        // Contact form handling
        const contactForm = document.getElementById('contact-form');
        if (contactForm) {
          contactForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const form = e.target as HTMLFormElement;
            const submitBtn = form.querySelector('button[type="submit"]') as HTMLButtonElement;
            const errorAlert = form.querySelector('.alert-error') as HTMLElement;
            const successAlert = form.querySelector('.alert-success') as HTMLElement;

            submitBtn.disabled = true;
            submitBtn.textContent = 'Sending...';
            errorAlert.style.display = 'none';
            successAlert.style.display = 'none';

            try {
              const response = await fetch(form.action, {
                method: 'POST',
                body: new FormData(form),
                headers: { 'Accept': 'application/json' }
              });

              if (response.ok) {
                successAlert.style.display = 'block';
                form.reset();
              } else {
                throw new Error('Form submission failed');
              }
            } catch (err) {
              errorAlert.style.display = 'block';
            } finally {
              submitBtn.disabled = false;
              submitBtn.textContent = 'Send';
            }
          });
        }

        // Lazy load map
        const mapLoadBtn = document.querySelector('.map-load-btn');
        const mapContainer = document.getElementById('map');

        function loadMap() {
          const mapLoader = document.querySelector('.map-loader') as HTMLElement;
          if (mapLoader) mapLoader.style.display = 'none';

          // Load Google Maps script dynamically
          const script = document.createElement('script');
          script.src = 'https://maps.googleapis.com/maps/api/js?key=AIzaSyAbx-haDz214H2OeMtvhdLKsT5o8a4sG04&libraries=marker&map_ids=be44c9d1f4868292&loading=async&callback=initMap';
          script.async = true;
          document.head.appendChild(script);
        }

        (window as any).initMap = function() {
          const latlng = { lat: 40.4406, lng: -79.9959 };
          const map = new google.maps.Map(document.getElementById('map')!, {
            zoom: 14,
            center: latlng,
            scrollwheel: false,
            mapId: 'be44c9d1f4868292',
          });

          const markerElement = document.createElement('div');
          markerElement.style.width = '48px';
          markerElement.style.height = '48px';
          markerElement.style.backgroundImage = 'url(/files/uploads/sneakyghost-pin.png)';
          markerElement.style.backgroundSize = 'contain';

          const marker = new google.maps.marker.AdvancedMarkerElement({
            map: map,
            position: latlng,
            content: markerElement,
            title: 'Sneaky Ghost Films HQ'
          });

          const infowindow = new google.maps.InfoWindow({
            content: '<b>Sneaky Ghost Films HQ</b><br>Pittsburgh, PA'
          });

          marker.addListener('click', () => {
            infowindow.open({ anchor: marker, map, shouldFocus: false });
          });
        };

        if (mapLoadBtn) {
          mapLoadBtn.addEventListener('click', loadMap);
        }

        // Auto-load map when it comes into view
        if ('IntersectionObserver' in window && mapContainer) {
          const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
              if (entry.isIntersecting) {
                loadMap();
                observer.disconnect();
              }
            });
          });
          observer.observe(mapContainer);
        }
      });
    </script>
  </Fragment>
</Layout>
